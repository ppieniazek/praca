{% extends "base.html" %}
{% load i18n %}
{% block title %}
  {% trans "Dashboard" %} - Paver
{% endblock title %}
{% block content %}
  <div class="flex flex-col gap-6 mt-4">
    <div class="card bg-base-100 shadow-xl border border-base-300">
      <div class="card-body">
        <h1 class="text-2xl font-bold flex items-center gap-2">
          {% trans "Witaj," %} {{ user.get_full_name|default:user.username }}!
        </h1>
        <p class="text-base-content/70">
          {% if user.is_owner %}
            {% trans "Zarządzasz organizacją:" %}
          {% else %}
            {% trans "Twoja organizacja:" %}
          {% endif %}
          <span class="badge badge-primary font-bold">{{ user.organization.name }}</span>
        </p>
        <div class="divider opacity-30 my-4"></div>
        {% if user.is_owner %}
          <!-- Właściciel: Bento Top Stats -->
          <div class="stats stats-vertical lg:stats-horizontal shadow-sm border border-base-200 w-full mb-6">
            <div class="stat">
              <div class="stat-figure text-accent">
                <svg xmlns="http://www.w3.org/2000/svg"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke-width="1.5"
                     stroke="currentColor"
                     class="w-8 h-8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6" />
                </svg>
              </div>
              <div class="stat-title">{% trans "Finanse Firmy" %}</div>
              <div class="stat-value text-2xl {% if total_company_balance < 0 %}text-error{% else %}text-success{% endif %}">
                {{ total_company_balance|floatformat:2 }} <span class="text-sm font-normal">PLN</span>
              </div>
              <div class="stat-desc mt-1">
                <a href="{% url 'business:finance_list' %}"
                   class="link link-accent link-hover font-medium">{% trans "Przejdź do Finansów" %} →</a>
              </div>
            </div>
            <div class="stat">
              <div class="stat-figure text-primary">
                <svg xmlns="http://www.w3.org/2000/svg"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke-width="1.5"
                     stroke="currentColor"
                     class="w-8 h-8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0z" />
                </svg>
              </div>
              <div class="stat-title">{% trans "Brygadziści" %}</div>
              <div class="stat-value text-3xl">{{ active_foremen_count }}</div>
              <div class="stat-desc">{% trans "Aktywni pracownicy terenowi" %}</div>
            </div>
            <div class="stat">
              <div class="stat-figure text-info">
                <svg xmlns="http://www.w3.org/2000/svg"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke-width="1.5"
                     stroke="currentColor"
                     class="w-8 h-8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 21v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21m0 0h4.5V3.75M5.25 21h4.5m1.5-16.5h3" />
                </svg>
              </div>
              <div class="stat-title">{% trans "Projekty" %}</div>
              <div class="stat-value text-3xl">{{ active_projects_count }}</div>
              <div class="stat-desc">{% trans "Trwające budowy" %}</div>
            </div>
            <div class="stat">
              <div class="stat-figure text-warning">
                <svg xmlns="http://www.w3.org/2000/svg"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke-width="1.5"
                     stroke="currentColor"
                     class="w-8 h-8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                </svg>
              </div>
              <div class="stat-title">
                {% trans "Wypłaty" %} ({{ payroll_stats.month|stringformat:"02d" }}/{{ payroll_stats.year }})
              </div>
              <div class="stat-value text-xl text-warning">
                {{ payroll_stats.total_net|floatformat:2 }} <span class="text-sm font-normal">PLN</span>
              </div>
              <div class="stat-desc flex items-center gap-1 mt-1 font-bold">
                {% trans "Status:" %}
                {% if payroll_stats.status == 'CLOSED' %}
                  <span class="text-success">{% trans "ZAMKNIĘTY" %}</span>
                {% elif payroll_stats.status == 'DRAFT' %}
                  <span class="text-warning">{% trans "W TOKU" %}</span>
                {% else %}
                  <span class="text-base-content/50">{% trans "NIE WYGENEROWANO" %}</span>
                {% endif %}
              </div>
            </div>
          </div>
          <!-- Właściciel: Quick Links -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <a href="{% url 'business:worker_list' %}"
               class="card bg-base-100 border border-base-200 shadow-sm hover:shadow-md transition-all hover:-translate-y-0.5 group">
              <div class="card-body p-6 flex flex-row items-center gap-4">
                <div class="bg-primary/10 text-primary p-4 rounded-xl group-hover:bg-primary group-hover:text-primary-content transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24"
                       stroke-width="1.5"
                       stroke="currentColor"
                       class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0z" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-bold text-lg leading-none mb-1 group-hover:text-primary transition-colors">
                    {% trans "Pracownicy" %}
                  </h3>
                  <p class="text-xs opacity-60">{% trans "Zarządzaj zespołem i stawkami." %}</p>
                </div>
              </div>
            </a>
            <a href="{% url 'business:project_list' %}"
               class="card bg-base-100 border border-base-200 shadow-sm hover:shadow-md transition-all hover:-translate-y-0.5 group">
              <div class="card-body p-6 flex flex-row items-center gap-4">
                <div class="bg-info/10 text-info p-4 rounded-xl group-hover:bg-info group-hover:text-info-content transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24"
                       stroke-width="1.5"
                       stroke="currentColor"
                       class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 21v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21m0 0h4.5V3.75M5.25 21h4.5m1.5-16.5h3" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-bold text-lg leading-none mb-1 group-hover:text-info transition-colors">{% trans "Projekty" %}</h3>
                  <p class="text-xs opacity-60">{% trans "Śledź budżet i realizacje." %}</p>
                </div>
              </div>
            </a>
            <a href="{% url 'business:timesheet_grid' %}"
               class="card bg-base-100 border border-base-200 shadow-sm hover:shadow-md transition-all hover:-translate-y-0.5 group">
              <div class="card-body p-6 flex flex-row items-center gap-4">
                <div class="bg-secondary/10 text-secondary p-4 rounded-xl group-hover:bg-secondary group-hover:text-secondary-content transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24"
                       stroke-width="1.5"
                       stroke="currentColor"
                       class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-bold text-lg leading-none mb-1 group-hover:text-secondary transition-colors">
                    {% trans "Czas Pracy" %}
                  </h3>
                  <p class="text-xs opacity-60">{% trans "Zatwierdzaj i modyfikuj." %}</p>
                </div>
              </div>
            </a>
          </div>
        {% else %}
          <!-- Brygadzista: Portfel + Czas Pracy -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% if wallet %}
              <div class="card bg-base-100 border border-base-200 shadow-sm">
                <div class="card-body items-center text-center p-8">
                  <div class="p-4 bg-accent/10 text-accent rounded-full mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke-width="1.5"
                         stroke="currentColor"
                         class="w-10 h-10">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6" />
                    </svg>
                  </div>
                  <h2 class="text-lg font-bold opacity-60 uppercase tracking-widest mb-2">{% trans "Twój Portfel" %}</h2>
                  <div class="text-5xl font-mono font-black {% if current_balance < 0 %}text-error{% else %}text-success{% endif %} mb-8">
                    {{ current_balance|floatformat:2 }} <span class="text-xl font-normal opacity-50">PLN</span>
                  </div>
                  <a href="{% url 'business:finance_list' %}"
                     class="btn btn-accent btn-wide shadow-sm">{% trans "Przejdź do Finansów" %}</a>
                </div>
              </div>
            {% endif %}
            <div class="card bg-base-100 border border-base-200 shadow-sm">
              <div class="card-body items-center text-center p-8">
                <div class="p-4 bg-secondary/10 text-secondary rounded-full mb-2">
                  <svg xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24"
                       stroke-width="1.5"
                       stroke="currentColor"
                       class="w-10 h-10">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z" />
                  </svg>
                </div>
                <h2 class="text-lg font-bold opacity-60 uppercase tracking-widest mb-4">{% trans "Ewidencja Ekipy" %}</h2>
                <p class="text-sm opacity-60 mb-8 max-w-xs">
                  {% trans "Wpisuj codziennie godziny pracy dla swojej brygady aby zaktualizować ewidencję." %}
                </p>
                <a href="{% url 'business:timesheet_grid' %}"
                   class="btn btn-secondary btn-wide shadow-sm">{% trans "Uzupełnij Ewidencję" %}</a>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock content %}
